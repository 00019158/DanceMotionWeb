<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin ‚Äî Dance Motion</title>
  <style>
    body{font-family:Inter,Arial;background:#e3f1fe;margin:0;padding:20px}
    .wrap{max-width:980px;margin:0 auto}
    .card{background:#fff;padding:16px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.06)}
    .top{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    input,select,textarea,button{padding:8px;border-radius:8px;border:1px solid #e6eef7;box-sizing:border-box}
    button{cursor:pointer}
    .row{display:flex;gap:8px;margin:8px 0}
    .col{flex:1}
    .orders{margin-top:12px}
    .order-item{padding:8px;border-radius:8px;background:#f7fbff;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center}
    .muted{color:#6b7280}
    .back{background:#eee;border:0;padding:8px;border-radius:8px}
    .order-actions{display:flex;gap:8px}
    .btn-small{padding:6px 10px;border-radius:8px;border:0;background:#e6eef7}
    .btn-delete{background:#ffd6d6;border:1px solid #ffb3b3}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <h2>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
      <div>
        <button id="back" class="back">‚Üê –ù–∞–∑–∞–¥ –≤ –º–∞–≥–∞–∑–∏–Ω</button>
      </div>
    </div>

    <div class="card">
      <div id="loginBlock">
        <div class="row">
          <input id="adminPass" type="password" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞" />
          <button id="adminLogin">–í–æ–π—Ç–∏</button>
        </div>
       
      </div>

      <div id="adminUI" style="display:none;margin-top:12px">
        <div style="display:flex;gap:8px;align-items:center">
          <div style="flex:1">
            <label class="muted">ID –∑–∞–∫–∞–∑–∞ (–ø—É—Å—Ç–æ ‚Äî –Ω–æ–≤—ã–π)</label>
            <input id="orderId" placeholder="ID (–∞–≤—Ç–æ)" />
          </div>
          <div style="flex:1">
            <label class="muted">Email –∫–ª–∏–µ–Ω—Ç–∞</label>
            <input id="orderEmail" placeholder="client@example.com" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label class="muted">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä</label>
            <select id="productSelect"></select>
          </div>
          <div style="width:120px">
            <label class="muted">–ö–æ–ª-–≤–æ</label>
            <input id="productQty" type="number" value="1" min="1" />
          </div>
          <div style="width:150px">
            <label class="muted">–¶–µ–Ω–∞ (—Å—É–º)</label>
            <input id="productPrice" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label class="muted">–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</label>
            <input id="orderName" />
          </div>
          <div class="col">
            <label class="muted">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input id="orderPhone" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label class="muted">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
            <input id="orderNote" />
          </div>
          <div style="width:220px">
            <label class="muted">–°—Ç–∞—Ç—É—Å</label>
            <select id="orderStatus">
              <option>–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option>
              <option>–§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è</option>
              <option>–í –¥–æ—Å—Ç–∞–≤–∫–µ</option>
              <option>–ü–æ–ª—É—á–µ–Ω–æ</option>
            </select>
          </div>
        </div>

        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="saveOrder" style="background:#004f73;color:#fff">–°–æ–∑–¥–∞—Ç—å / –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
          <button id="clearForm">–û—á–∏—Å—Ç–∏—Ç—å</button>
          <button id="refreshList">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
        </div>

        <div class="orders" id="ordersList" style="margin-top:10px"></div>

        <div style="margin-top:10px" class="muted">–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∞–¥–º–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.</div>
      </div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const PRODUCTS = [
    {id:1,title:'–¢—É—Ñ–ª–∏ –†–µ–π—Ç–∏–Ω–≥-–ë–µ–ª—ã–µ (–ö–æ–∂–∞)',price:350000},
    {id:2,title:'–¢—É—Ñ–ª–∏ –†–µ–π—Ç–∏–Ω–≥ - –°–≤–µ—Ç–ª–æ-–ë–µ–∂–µ–≤—ã–µ (–°–∞—Ç–∏–Ω)',price:350000},
    {id:3,title:'–¢—É—Ñ–ª–∏ –†–µ–π—Ç–∏–Ω–≥ - –ö–æ—Ä–∏—á–Ω–µ–≤—ã–µ (–ö–æ–∂–∞)',price:350000},
    {id:4,title:'–¢—É—Ñ–ª–∏ –†–µ–π—Ç–∏–Ω–≥- –ö—Ä–∞—Å–Ω—ã–µ (–ö–æ–∂–∞)',price:350000},
    {id:5,title:'–¢—É—Ñ–ª–∏ –†–µ–π—Ç–∏–Ω–≥- –ß–µ—Ä–Ω—ã–µ (–°–∞—Ç–∏–Ω)',price:350000},
    {id:6,title:'–¢—É—Ñ–ª–∏ –†–µ–π—Ç–∏–Ω–≥- –ö–æ—Ä–∏—á–Ω–µ–≤—ã–µ (–°–∞—Ç–∏–Ω)',price:350000},
  ];
  const LS_ORDERS = 'dm_orders_v1';
  const TELEGRAM_BOT_TOKEN = '8182609479:AAG7AqcB8naX92u2XlHkxwp9R9IBhEhfoW0';
  const TELEGRAM_CHAT_ID = '8492577684';
  const ADMIN_PASSWORD = 'admin123';

  // DOM
  const loginBlock = document.getElementById('loginBlock');
  const adminUI = document.getElementById('adminUI');
  const adminLogin = document.getElementById('adminLogin');
  const adminPass = document.getElementById('adminPass');
  const productSelect = document.getElementById('productSelect');
  const productPrice = document.getElementById('productPrice');
  const productQty = document.getElementById('productQty');
  const ordersList = document.getElementById('ordersList');

  const orderIdInput = document.getElementById('orderId');
  const orderEmail = document.getElementById('orderEmail');
  const orderName = document.getElementById('orderName');
  const orderPhone = document.getElementById('orderPhone');
  const orderNote = document.getElementById('orderNote');
  const orderStatus = document.getElementById('orderStatus');
  const saveOrderBtn = document.getElementById('saveOrder');
  const refreshListBtn = document.getElementById('refreshList');
  const clearFormBtn = document.getElementById('clearForm');

  const goHomeBtn = document.getElementById('back');
  if (goHomeBtn) goHomeBtn.addEventListener('click', () => location.href = 'index.html');

  function getOrders(){ return JSON.parse(localStorage.getItem(LS_ORDERS) || '[]'); }
  function saveOrders(list){ localStorage.setItem(LS_ORDERS, JSON.stringify(list)); }

  function buildProducts(){
    if(!productSelect) return;
    productSelect.innerHTML = '';
    PRODUCTS.forEach(p=>{
      const opt = document.createElement('option');
      opt.value = p.id;
      opt.textContent = `${p.title} ‚Äî ${p.price.toLocaleString()} —Å—É–º`;
      productSelect.appendChild(opt);
    });
    productPrice.value = PRODUCTS[0].price;
  }

  if (productSelect) {
    productSelect.addEventListener('change', ()=> {
      const p = PRODUCTS.find(x=>x.id == productSelect.value);
      if(p) productPrice.value = p.price;
    });
  }

  if (adminLogin) {
    adminLogin.addEventListener('click', ()=> {
      if(!adminPass) return alert('–ü–æ–ª–µ –ø–∞—Ä–æ–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç');
      if(adminPass.value === ADMIN_PASSWORD){
        if (loginBlock) loginBlock.style.display = 'none';
        if (adminUI) adminUI.style.display = 'block';
        buildProducts();
        renderOrders();
      } else alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
    });
  }

  function generateOrderId(){
    const orders = getOrders();
    const max = orders.reduce((m,o)=> Math.max(m, o.id || 500), 500);
    return max + 1;
  }

  async function sendTelegram(text){
    try{
      const res = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({chat_id: TELEGRAM_CHAT_ID, text, parse_mode:'HTML'})
      });
      if(!res.ok) throw new Error(await res.text());
      console.log('‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
    }catch(e){
      console.error('–û—à–∏–±–∫–∞ Telegram:', e);
    }
  }

  if (saveOrderBtn) {
    saveOrderBtn.addEventListener('click', async ()=> {
      const pid = productSelect ? +productSelect.value : 1;
      const product = PRODUCTS.find(p=>p.id===pid) || PRODUCTS[0];
      const qty = productQty ? +productQty.value || 1 : 1;
      const price = productPrice ? +productPrice.value || product.price : product.price;
      const name = orderName ? orderName.value.trim() : '';
      const phone = orderPhone ? orderPhone.value.trim() : '';
      const email = orderEmail ? orderEmail.value.trim() : '';
      const note = orderNote ? orderNote.value.trim() : '';
      const status = orderStatus ? orderStatus.value : '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ';

      if(!name || !phone){ alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω'); return; }

      let id = orderIdInput ? orderIdInput.value.trim() : '';
      if(!id) id = generateOrderId(); else id = +id;

      const orders = getOrders();
      const existing = orders.findIndex(o => o.id === id);
      const now = Date.now();
      const orderData = {
        id, name, phone, email, note, status,
        items:[{id:pid, title:product.title, price, qty}],
        total:price*qty, updatedAt:now, createdAt: now
      };

      if(existing >= 0) orders[existing] = orderData;
      else orders.push(orderData);
      saveOrders(orders);

      await sendTelegram(`üìù –û–±–Ω–æ–≤–ª—ë–Ω –∑–∞–∫–∞–∑ #${id}\n–ò–º—è: ${name}\n–¢–µ–ª: ${phone}\n–°—Ç–∞—Ç—É—Å: ${status}\n–¢–æ–≤–∞—Ä: ${product.title} √ó${qty}\n–°—É–º–º–∞: ${(price*qty).toLocaleString()} —Å—É–º`);
      alert('‚úÖ –ó–∞–∫–∞–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
      renderOrders();
    });
  }

  // –û—Ç–∫—Ä—ã—Ç—å –∑–∞–∫–∞–∑ –≤ —Ñ–æ—Ä–º–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  function openOrder(id){
    const orders = getOrders();
    const o = orders.find(x=>x.id === +id);
    if(!o){ alert('–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω'); return; }
    // –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è
    if(orderIdInput) orderIdInput.value = o.id;
    if(orderName) orderName.value = o.name || '';
    if(orderPhone) orderPhone.value = o.phone || '';
    if(orderEmail) orderEmail.value = o.email || '';
    if(orderNote) orderNote.value = o.note || '';
    if(orderStatus) orderStatus.value = o.status || '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ';
    // –µ—Å–ª–∏ –≤ –∑–∞–∫–∞–∑–µ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ —Å–µ–ª–µ–∫—Ç–µ –∏ —Ü–µ–Ω—É/–∫–æ–ª-–≤–æ
    const firstItem = (o.items && o.items[0]) || null;
    if(firstItem && productSelect){
      productSelect.value = firstItem.id;
      productPrice.value = firstItem.price;
      if(productQty) productQty.value = firstItem.qty;
    }
    // –ø–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å (–µ—Å–ª–∏ —Å–∫—Ä—ã—Ç–∞) –∏ –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ —Ñ–æ—Ä–º–µ
    if(loginBlock) loginBlock.style.display = 'none';
    if(adminUI) {
      adminUI.style.display = 'block';
      adminUI.scrollIntoView({behavior:'smooth', block:'start'});
    }
  }

  // –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑
  function deleteOrder(id){
    if(!confirm(`–£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑ #${id}? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`)) return;
    let orders = getOrders();
    orders = orders.filter(o => o.id !== +id);
    saveOrders(orders);
    renderOrders();
  }

  // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –û—Ç–∫—Ä—ã—Ç—å –∏ –£–¥–∞–ª–∏—Ç—å
  function renderOrders(){
    const list = getOrders().slice().reverse();
    if(!ordersList) return;
    if(list.length === 0){
      ordersList.innerHTML = '<div class="muted">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>';
      return;
    }
    ordersList.innerHTML = list.map(o=>`
      <div class="order-item">
        <div><b>ID ${o.id}</b> ‚Äî ${o.name || '‚Äî'} ‚Äî ${o.status || '‚Äî'}</div>
        <div class="order-actions">
          <button class="btn-small open-btn" data-id="${o.id}">–û—Ç–∫—Ä—ã—Ç—å</button>
          <button class="btn-small btn-delete" data-id="${o.id}">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
      </div>`
    ).join('');
  }

  // –î–µ–ª–µ–≥–∏—Ä—É–µ–º –∫–ª–∏–∫–∏ –ø–æ —Å–ø–∏—Å–∫—É –∑–∞–∫–∞–∑–æ–≤
  if(ordersList){
    ordersList.addEventListener('click', (e) => {
      const btn = e.target.closest('button');
      if(!btn) return;
      const id = btn.getAttribute('data-id');
      if(!id) return;
      if(btn.classList.contains('open-btn')) {
        openOrder(id);
      } else if(btn.classList.contains('btn-delete')) {
        deleteOrder(id);
      }
    });
  }

  if (refreshListBtn) refreshListBtn.addEventListener('click', renderOrders);
  if (clearFormBtn) clearFormBtn.addEventListener('click', ()=> {
    if(orderIdInput) orderIdInput.value = '';
    if(orderName) orderName.value = '';
    if(orderPhone) orderPhone.value = '';
    if(orderEmail) orderEmail.value = '';
    if(orderNote) orderNote.value = '';
    if(orderStatus) orderStatus.value = '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ';
    if(productSelect) productSelect.selectedIndex = 0;
    if(productPrice) productPrice.value = (PRODUCTS[0] && PRODUCTS[0].price) || '';
    if(productQty) productQty.value = 1;
  });

});
</script>
</body>
</html>
