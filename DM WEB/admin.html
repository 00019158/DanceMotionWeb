<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin ‚Äî Dance Motion</title>
  <style>
    body{font-family:Inter,Arial;background:#e3f1fe;margin:0;padding:20px}
    .wrap{max-width:980px;margin:0 auto}
    .card{background:#fff;padding:16px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.06)}
    .top{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    input,select,textarea,button{padding:8px;border-radius:8px;border:1px solid #e6eef7;box-sizing:border-box}
    button{cursor:pointer}
    .row{display:flex;gap:8px;margin:8px 0}
    .col{flex:1}
    .orders{margin-top:12px}
    .order-item{padding:8px;border-radius:8px;background:#f7fbff;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center}
    .muted{color:#6b7280}
    .back{background:#eee;border:0;padding:8px;border-radius:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <h2>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
      <div>
        <button id="back" class="back">‚Üê –ù–∞–∑–∞–¥ –≤ –º–∞–≥–∞–∑–∏–Ω</button>
      </div>
    </div>

    <div class="card">
      <div id="loginBlock">
        <div class="row">
          <input id="adminPass" type="password" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞" />
          <button id="adminLogin">–í–æ–π—Ç–∏</button>
        </div>
        <div class="muted">–ü–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: <b>admin123</b></div>
      </div>

      <div id="adminUI" style="display:none;margin-top:12px">
        <div style="display:flex;gap:8px;align-items:center">
          <div style="flex:1">
            <label class="muted">ID –∑–∞–∫–∞–∑–∞ (–ø—É—Å—Ç–æ ‚Äî –Ω–æ–≤—ã–π)</label>
            <input id="orderId" placeholder="ID (–∞–≤—Ç–æ)" />
          </div>
          <div style="flex:1">
            <label class="muted">Email –∫–ª–∏–µ–Ω—Ç–∞</label>
            <input id="orderEmail" placeholder="client@example.com" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label class="muted">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä</label>
            <select id="productSelect"></select>
          </div>
          <div style="width:120px">
            <label class="muted">–ö–æ–ª-–≤–æ</label>
            <input id="productQty" type="number" value="1" min="1" />
          </div>
          <div style="width:150px">
            <label class="muted">–¶–µ–Ω–∞ (—Å—É–º)</label>
            <input id="productPrice" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label class="muted">–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</label>
            <input id="orderName" />
          </div>
          <div class="col">
            <label class="muted">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input id="orderPhone" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label class="muted">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
            <input id="orderNote" />
          </div>
          <div style="width:220px">
            <label class="muted">–°—Ç–∞—Ç—É—Å</label>
            <select id="orderStatus">
              <option>–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option>
              <option>–§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è</option>
              <option>–í –¥–æ—Å—Ç–∞–≤–∫–µ</option>
              <option>–ü–æ–ª—É—á–µ–Ω–æ</option>
            </select>
          </div>
        </div>

        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="saveOrder" style="background:#004f73;color:#fff">–°–æ–∑–¥–∞—Ç—å / –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
          <button id="clearForm">–û—á–∏—Å—Ç–∏—Ç—å</button>
          <button id="refreshList">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
        </div>

        <div class="orders" id="ordersList" style="margin-top:10px"></div>

        <div style="margin-top:10px" class="muted">–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∞–¥–º–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.</div>
      </div>
    </div>
  </div>

<script>
  
  const PRODUCTS = [
    {id:1,title:'–¢—É—Ñ–ª–∏ –†–µ–π—Ç–∏–Ω–≥-–ë–µ–ª—ã–µ (–ö–æ–∂–∞)',price:350000},
    {id:2,title:'–¢—É—Ñ–ª–∏ –†–µ–π—Ç–∏–Ω–≥ - –°–≤–µ—Ç–ª–æ-–ë–µ–∂–µ–≤—ã–µ (–°–∞—Ç–∏–Ω)',price:350000},
    {id:3,title:'–¢—É—Ñ–ª–∏ –†–µ–π—Ç–∏–Ω–≥ - –ö–æ—Ä–∏—á–Ω–µ–≤—ã–µ (–ö–æ–∂–∞)',price:350000},
    {id:4,title:'–¢—É—Ñ–ª–∏ –†–µ–π—Ç–∏–Ω–≥- –ö—Ä–∞—Å–Ω—ã–µ (–ö–æ–∂–∞)',price:350000},
    {id:5,title:'–¢—É—Ñ–ª–∏ –†–µ–π—Ç–∏–Ω–≥- –ß–µ—Ä–Ω—ã–µ (–°–∞—Ç–∏–Ω)',price:350000},
    {id:6,title:'–¢—É—Ñ–ª–∏ –†–µ–π—Ç–∏–Ω–≥- –ö–æ—Ä–∏—á–Ω–µ–≤—ã–µ (–°–∞—Ç–∏–Ω)',price:350000},
  ];
  const LS_ORDERS = 'dm_orders_v1';
  const TELEGRAM_BOT_TOKEN = '8182609479:AAG7AqcB8naX92u2XlHkxwp9R9IBhEhfoW0';
  const TELEGRAM_CHAT_ID = '8492577684';
  const ADMIN_PASSWORD = 'admin123';

  const loginBlock = document.getElementById('loginBlock');
  const adminUI = document.getElementById('adminUI');
  const adminLogin = document.getElementById('adminLogin');
  const adminPass = document.getElementById('adminPass');
  const productSelect = document.getElementById('productSelect');
  const productPrice = document.getElementById('productPrice');
  const productQty = document.getElementById('productQty');
  const ordersList = document.getElementById('ordersList');

  const orderIdInput = document.getElementById('orderId');
  const orderEmail = document.getElementById('orderEmail');
  const orderName = document.getElementById('orderName');
  const orderPhone = document.getElementById('orderPhone');
  const orderNote = document.getElementById('orderNote');
  const orderStatus = document.getElementById('orderStatus');
  const saveOrderBtn = document.getElementById('saveOrder');
  const refreshListBtn = document.getElementById('refreshList');
  const clearFormBtn = document.getElementById('clearForm');
  const goHome = document.getElementById('goHome');

  goHome.onclick = ()=> location.href = 'index.html';

  function buildProducts(){
    productSelect.innerHTML = '';
    PRODUCTS.forEach(p=>{
      const opt = document.createElement('option');
      opt.value = p.id;
      opt.textContent = `${p.title} ‚Äî ${p.price.toLocaleString()} —Å—É–º`;
      productSelect.appendChild(opt);
    });
    productPrice.value = PRODUCTS[0].price;
  }

  productSelect.onchange = ()=> {
    const p = PRODUCTS.find(x=>x.id == productSelect.value);
    if(p) productPrice.value = p.price;
  };

  adminLogin.onclick = ()=>{
    if(adminPass.value === ADMIN_PASSWORD){
      loginBlock.style.display = 'none';
      adminUI.style.display = 'block';
      buildProducts();
      renderOrders();
    } else alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
  };

  function getOrders(){ return JSON.parse(localStorage.getItem(LS_ORDERS) || '[]'); }
  function saveOrders(list){ localStorage.setItem(LS_ORDERS, JSON.stringify(list)); }

  function generateOrderId(){
    const orders = getOrders();
    const max = orders.reduce((m,o)=> Math.max(m, o.id || 500), 500);
    return max + 1;
  }

  async function sendTelegram(text){
    try{
      const res = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({chat_id: TELEGRAM_CHAT_ID, text, parse_mode:'HTML'})
      });
      if(!res.ok) throw new Error(await res.text());
      console.log('‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
    }catch(e){
      console.error('–û—à–∏–±–∫–∞ Telegram:', e);
      alert('–û—à–∏–±–∫–∞ Telegram!');
    }
  }

  saveOrderBtn.onclick = async ()=>{
    const pid = +productSelect.value;
    const product = PRODUCTS.find(p=>p.id===pid);
    const qty = +productQty.value || 1;
    const price = +productPrice.value || product.price;
    const name = orderName.value.trim();
    const phone = orderPhone.value.trim();
    const email = orderEmail.value.trim();
    const note = orderNote.value.trim();
    const status = orderStatus.value;

    if(!name || !phone){ alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω'); return; }

    let id = orderIdInput.value.trim();
    if(!id) id = generateOrderId(); else id = +id;

    const orders = getOrders();
    const existing = orders.findIndex(o => o.id === id);
    const now = Date.now();
    const orderData = {
      id, name, phone, email, note, status,
      items:[{id:pid, title:product.title, price, qty}],
      total:price*qty, updatedAt:now, createdAt:now
    };

    if(existing >= 0) orders[existing] = orderData;
    else orders.push(orderData);
    saveOrders(orders);

    await sendTelegram(`üìù –û–±–Ω–æ–≤–ª—ë–Ω –∑–∞–∫–∞–∑ #${id}\n–ò–º—è: ${name}\n–¢–µ–ª: ${phone}\n–°—Ç–∞—Ç—É—Å: ${status}\n–¢–æ–≤–∞—Ä: ${product.title} √ó${qty}\n–°—É–º–º–∞: ${(price*qty).toLocaleString()} —Å—É–º`);
    alert('‚úÖ –ó–∞–∫–∞–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
    renderOrders();
  };

  function renderOrders(){
    const list = getOrders().reverse();
    ordersList.innerHTML = list.map(o=>`
      <div class="order-item">
        <div><b>ID ${o.id}</b> ‚Äî ${o.name} ‚Äî ${o.status}</div>
        <button onclick="window.open('order.html?id=${o.id}','_blank')">–û—Ç–∫—Ä—ã—Ç—å</button>
      </div>`).join('') || '<div class="muted">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>';
  }

  refreshListBtn.onclick = renderOrders;
  clearFormBtn.onclick = ()=> {
    orderIdInput.value = '';
    orderName.value = '';
    orderPhone.value = '';
    orderEmail.value = '';
    orderNote.value = '';
    orderStatus.value = '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ';
  };


</script>
</body>
</html>
